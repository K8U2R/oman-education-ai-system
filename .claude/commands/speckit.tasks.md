---
description: توليد قائمة مهام عملية (tasks.md) مرتبة حسب التبعية للميزة بناءً على مستندات التصميم المتاحة.
handoffs: 
  - label: تحليل الاتساق
    agent: speckit.analyze
    prompt: شغل تحليل المشروع للاتساق
    send: true
  - label: تنفيذ المشروع
    agent: speckit.implement
    prompt: ابدأ التنفيذ على مراحل
    send: true
---

## مدخلات المستخدم (User Input)

```text
$ARGUMENTS
```

يجب عليك **مراعاة** مدخلات المستخدم قبل المتابعة (إذا لم تكن فارغة).

## المخطط العام (Outline)

1. **الإعداد**: شغل `.specify/scripts/bash/check-prerequisites.sh --json` من جذر المستودع وقم بتحليل `FEATURE_DIR` وقائمة `AVAILABLE_DOCS`. يجب أن تكون جميع المسارات مطلقة. للاقتباسات الفردية في الوسائط مثل "I'm Groot"، استخدم صيغة الهروب: مثال `'I'\''m Groot'` (أو اقتباس مزدوج إذا أمكن: `"I'm Groot"`).

2. **تحميل مستندات التصميم**: اقرأ من `FEATURE_DIR`:
   - **مطلوب**: `plan.md` (المكدس التقني، المكتبات، الهيكل)، `spec.md` (قصص المستخدم مع الأولويات)
   - **اختياري**: `data-model.md` (الكيانات)، `contracts/` (نقاط النهاية API)، `research.md` (القرارات)، `quickstart.md` (سيناريوهات الاختبار)
   - ملاحظة: ليس كل المشاريع لديها جميع المستندات. أنشئ المهام بناءً على ما هو متاح.

3. **تنفيذ سير عمل توليد المهام**:
   - حمل `plan.md` واستخرج المكدس التقني، المكتبات، وهيكل المشروع
   - حمل `spec.md` واستخرج قصص المستخدم مع أولوياتها (P1, P2, P3, إلخ)
   - إذا وجد `data-model.md`: استخرج الكيانات واربطها بقصص المستخدم
   - إذا وجد `contracts/`: اربط نقاط النهاية بقصص المستخدم
   - إذا وجد `research.md`: استخرج القرارات لمهام الإعداد
   - توليد المهام منظمة حسب قصة المستخدم (انظر قواعد توليد المهام أدناه)
   - توليد رسم بياني للتبعية يوضح ترتيب إكمال قصة المستخدم
   - إنشاء أمثلة التنفيذ المتوازي لكل قصة مستخدم
   - التحقق من اكتمال المهمة (كل قصة مستخدم لديها كل المهام اللازمة، وقابلة للاختبار بشكل مستقل)

4. **توليد tasks.md**: استخدم `.specify/templates/tasks-template.md` كهيكل، واملأه بـ:
   - اسم الميزة الصحيح من `plan.md`
   - المرحلة 1: مهام الإعداد (تهيئة المشروع)
   - المرحلة 2: المهام التأسيسية (المتطلبات الأساسية المحظورة لجميع قصص المستخدم)
   - المرحلة 3+: مرحلة واحدة لكل قصة مستخدم (بترتيب الأولوية من `spec.md`)
   - تتضمن كل مرحلة: هدف القصة، معايير اختبار مستقلة، اختبارات (إذا طلبت)، مهام التنفيذ
   - المرحلة النهائية: التحسين والمخاوف المتقاطعة
   - يجب أن تتبع جميع المهام تنسيق القائمة الصارم (انظر قواعد توليد المهام أدناه)
   - مسارات ملفات واضحة لكل مهمة
   - قسم التبعيات يوضح ترتيب إكمال القصة
   - أمثلة التنفيذ المتوازي لكل قصة
   - قسم استراتيجية التنفيذ (MVP أولاً، تسليم تزايدي)

5. **التقرير**: مسار الإخراج إلى `tasks.md` والملخص:
   - إجمالي عدد المهام
   - عدد المهام لكل قصة مستخدم
   - فرص التنفيذ المتوازي المحددة
   - معايير اختبار مستقلة لكل قصة
   - نطاق MVP المقترح (عادة قصة المستخدم 1 فقط)
   - التحقق من التنسيق: تأكد من أن جميع المهام تتبع تنسيق القائمة (checkbox, ID, labels, file paths)

سياق لتوليد المهام: $ARGUMENTS

يجب أن يكون `tasks.md` قابلاً للتنفيذ فوراً - كل مهمة يجب أن تكون محددة بما يكفي ليتمكن نموذج لغوي كبير (LLM) من إكمالها دون سياق إضافي.

## قواعد توليد المهام (Task Generation Rules)

**حاسم**: يجب تنظيم المهام حسب قصة المستخدم لتمكين التنفيذ والاختبار المستقل.

**الاختبارات اختيارية**: قم بتوليد مهام الاختبار فقط إذا طلب ذلك صراحة في مواصفات الميزة أو إذا طلب المستخدم نهج TDD.

### تنسيق القائمة (مطلوب)

كل مهمة يجب أن تتبع بصرامة هذا التنسيق:

```text
- [ ] [TaskID] [P?] [Story?] الوصف مع مسار الملف
```

**مكونات التنسيق**:

1. **مربع الاختيار**: ابدأ دائماً بـ `- [ ]` (markdown checkbox)
2. **معرف المهمة**: رقم تسلسلي (T001, T002, T003...) بترتيب التنفيذ
3. **علامة [P]**: قم بتضمينها فقط إذا كانت المهمة قابلة للتوازي (ملفات مختلفة، لا تبعيات على مهام غير مكتملة)
4. **تسمية [Story]**: مطلوبة لمهام مرحلة قصة المستخدم فقط
   - التنسيق: [US1], [US2], [US3], إلخ (يربط بقصص المستخدم من spec.md)
   - مرحلة الإعداد: لا توجد تسمية قصة
   - المرحلة التأسيسية: لا توجد تسمية قصة
   - مراحل قصة المستخدم: يجب أن يكون لها تسمية قصة
   - مرحلة التحسين: لا توجد تسمية قصة
5. **الوصف**: إجراء واضح مع مسار الملف الدقيق

**أمثلة**:

- ✅ صحيح: `- [ ] T001 إنشاء هيكل المشروع وفقاً لخطة التنفيذ`
- ✅ صحيح: `- [ ] T005 [P] تنفيذ البرمجيات الوسيطة للمصادقة في src/middleware/auth.py`
- ✅ صحيح: `- [ ] T012 [P] [US1] إنشاء نموذج المستخدم في src/models/user.py`
- ✅ صحيح: `- [ ] T014 [US1] تنفيذ خدمة المستخدم في src/services/user_service.py`
- ❌ خطأ: `- [ ] إنشاء نموذج المستخدم` (مفقود المعرف وتسمية القصة)
- ❌ خطأ: `T001 [US1] إنشاء نموذج` (مفقود مربع الاختيار)
- ❌ خطأ: `- [ ] [US1] إنشاء نموذج المستخدم` (مفقود معرف المهمة)
- ❌ خطأ: `- [ ] T001 [US1] إنشاء نموذج` (مفقود مسار الملف)

### تنظيم المهام

1. **من قصص المستخدم (spec.md)** - التنظيم الأساسي:
   - كل قصة مستخدم (P1, P2, P3...) تحصل على مرحلتها الخاصة
   - اربط جميع المكونات ذات الصلة بقصتها:
     - النماذج اللازمة لتلك القصة
     - الخدمات اللازمة لتلك القصة
     - نقاط النهاية/واجهة المستخدم اللازمة لتلك القصة
     - إذا طلبت اختبارات: اختبارات خاصة بتلك القصة
   - حدد تبعيات القصة (معظم القصص يجب أن تكون مستقلة)

2. **من العقود (Contracts)**:
   - اربط كل عقد/نقطة نهاية ← بقصة المستخدم التي تخدمها
   - إذا طلبت اختبارات: كل عقد ← مهمة اختبار العقد [P] قبل التنفيذ في مرحلة تلك القصة

3. **من نموذج البيانات (Data Model)**:
   - اربط كل كيان بقصة (قصص) المستخدم التي تحتاجه
   - إذا كان الكيان يخدم قصصاً متعددة: ضعه في القصة الأبكر أو مرحلة الإعداد
   - العلاقات ← مهام طبقة الخدمة في مرحلة القصة المناسبة

4. **من الإعداد/البنية التحتية**:
   - البنية التحتية المشتركة ← مرحلة الإعداد (المرحلة 1)
   - المهام التأسيسية/المحظورة ← المرحلة التأسيسية (المرحلة 2)
   - إعداد خاص بالقصة ← ضمن مرحلة تلك القصة

### هيكل المرحلة

- **المرحلة 1**: الإعداد (تهيئة المشروع)
- **المرحلة 2**: تأسيسية (المتطلبات الأساسية المحظورة - يجب أن تكتمل قبل قصص المستخدم)
- **المرحلة 3+**: قصص المستخدم بترتيب الأولوية (P1, P2, P3...)
  - ضمن كل قصة: اختبارات (إذا طلبت) ← نماذج ← خدمات ← نقاط نهاية ← تكامل
  - كل مرحلة يجب أن تكون زيادة كاملة وقابلة للاختبار بشكل مستقل
- **المرحلة النهائية**: التحسين والمخاوف المتقاطعة
