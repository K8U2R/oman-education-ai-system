---
description: تحديد المجالات غير المحددة بدقة في مواصفات الميزة الحالية من خلال طرح ما يصل إلى 5 أسئلة توضيحية مستهدفة للغاية وتشفير الإجابات مرة أخرى في المواصفات.
handoffs: 
  - label: بناء الخطة التقنية
    agent: speckit.plan
    prompt: أنشئ خطة للمواصفات. أنا أبني...
---

## مدخلات المستخدم (User Input)

```text
$ARGUMENTS
```

يجب عليك **مراعاة** مدخلات المستخدم قبل المتابعة (إذا لم تكن فارغة).

## المخطط العام (Outline)

الهدف: اكتشاف وتقليل الغموض أو نقاط القرار المفقودة في مواصفات الميزة النشطة وتسجيل التوضيحات مباشرة في ملف المواصفات.

ملاحظة: من المتوقع تشغيل سير عمل التوضيح هذا (وإكماله) قبل استدعاء `/speckit.plan`. إذا ذكر المستخدم صراحة أنه يتخطى التوضيح (مثلاً، تجربة استكشافية)، يمكنك المتابعة، لكن يجب أن تحذر من زيادة مخاطر إعادة العمل في المراحل اللاحقة.

خطوات التنفيذ:

1. شغل `.specify/scripts/bash/check-prerequisites.sh --json --paths-only` من جذر المستودع **مرة واحدة** (الوضع المدمج `--json --paths-only` / `-Json -PathsOnly`). قم بتحليل حقول حمولة JSON الدنيا:
   - `FEATURE_DIR`
   - `FEATURE_SPEC`
   - (اختيارياً التقاط `IMPL_PLAN`, `TASKS` لتدفقات متسلسلة مستقبلية.)
   - إذا فشل تحليل JSON، توقف ووجه المستخدم لإعادة تشغيل `/speckit.specify` أو التحقق من بيئة فرع الميزة.
   - للاقتباسات الفردية في الوسائط مثل "I'm Groot"، استخدم صيغة الهروب: مثال `'I'\''m Groot'` (أو اقتباس مزدوج إذا أمكن: `"I'm Groot"`).

2. حمل ملف المواصفات الحالي. قم بإجراء فحص منظم للغموض والتغطية باستخدام هذا التصنيف. لكل فئة، حدد الحالة: واضح / جزئي / مفقود. أنتج خريطة تغطية داخلية تستخدم لتحديد الأولويات (لا تخرج الخريطة الخام إلا إذا لم يتم طرح أسئلة).

   النطاق الوظيفي والسلوك:
   - أهداف المستخدم الأساسية ومعايير النجاح
   - تصريحات صريحة خارج النطاق
   - تمايز أدوار المستخدم / الشخصيات

   المجال ونموذج البيانات:
   - الكيانات، السمات، العلاقات
   - قواعد الهوية والفرادة
   - دورة الحياة/انتقالات الحالة
   - افتراضات حجم البيانات / المقياس

   التفاعل وتدفق تجربة المستخدم:
   - رحلات المستخدم الحرجة / التسلسلات
   - حالات الخطأ/الفراغ/التحميل
   - ملاحظات إمكانية الوصول أو التوطين

   سمات الجودة غير الوظيفية:
   - الأداء (الكمون، أهداف الإنتاجية)
   - القابلية للتوسع (أفقي/عمودي، الحدود)
   - الموثوقية والتوافر (وقت التشغيل، توقعات الاسترداد)
   - القابلية للملاحظة (التسجيل، المقاييس، إشارات التتبع)
   - الأمان والخصوصية (المصادقة/التفويض، حماية البيانات، افتراضات التهديد)
   - الامتثال / القيود التنظيمية (إن وجدت)

   التكامل والتبعيات الخارجية:
   - الخدمات/APIs الخارجية وأوضاع الفشل
   - تنسيقات استيراد/تصدير البيانات
   - افتراضات البروتوكول/الإصدار

   الحالات الحدية ومعالجة الفشل:
   - السيناريوهات السلبية
   - تحديد المعدل / التقييد
   - حل التعارض (مثلاً، التعديلات المتزامنة)

   القيود والمفاضلات:
   - القيود التقنية (اللغة، التخزين، الاستضافة)
   - المفاضلات الصريحة أو البدائل المرفوضة

   المصطلحات والاتساق:
   - مصطلحات المسرد القانوني
   - تجنب المرادفات / المصطلحات المهملة

   إشارات الاكتمال:
   - قابلية اختبار معايير القبول
   - مؤشرات قابلة للقياس بأسلوب "تعريف الإنجاز" (Definition of Done)

   متفرقات / عناصر نائبة:
   - علامات TODO / قرارات غير محلولة
   - صفات غامضة ("قوي"، "بديهي") تفتقر للكمية

   لكل فئة بحالة "جزئي" أو "مفقود"، أضف فرصة سؤال مرشح ما لم:
   - لن يغير التوضيح استراتيجية التنفيذ أو التحقق بشكل جوهري
   - من الأفضل تأجيل المعلومات لمرحلة التخطيط (لاحظ ذلك داخلياً)

3. توليد (داخلياً) قائمة انتظار ذات أولوية لأسئلة التوضيح المرشحة (بحد أقصى 5). لا تخرجها جميعاً دفعة واحدة. طبق هذه القيود:
    - حد أقصى 10 أسئلة إجمالية عبر الجلسة بأكملها.
    - كل سؤال يجب أن يكون قابلاً للإجابة بـ إما:
       - اختيار قصير من متعدد (2–5 خيارات متميزة وحصرية)، أو
       - إجابة بكلمة واحدة / عبارة قصيرة (قيد صراحة: "أجب في <=5 كلمات").
    - ضَمِّن فقط الأسئلة التي تؤثر إجاباتها بشكل مادي على الهندسة، نمذجة البيانات، تفكيك المهام، تصميم الاختبار، سلوك UX، الجاهزية التشغيلية، أو التحقق من الامتثال.
    - ضمان توازن تغطية الفئة: حاول تغطية الفئات غير المحلولة ذات التأثير الأعلى أولاً؛ تجنب طرح سؤالين منخفضي التأثير عندما يكون هناك مجال واحد عالي التأثير (مثل الوضع الأمني) غير محلول.
    - استبعد الأسئلة المجابة بالفعل، التفضيلات الأسلوبية التافهة، أو تفاصيل التنفيذ على مستوى الخطة (ما لم تعيق الصحة).
    - فضل التوضيحات التي تقلل مخاطر إعادة العمل لاحقاً أو تمنع اختبارات القبول غير المتوافقة.
    - إذا بقيت أكثر من 5 فئات غير محلولة، حدد أفضل 5 حسب الاستدلال (التأثير * عدم اليقين).

4. حلقة الاستجواب المتسلسلة (تفاعلية):
    - اعرض سؤالاً واحداً بالضبط في كل مرة.
    - لأسئلة الاختيار من متعدد:
       - **حلل جميع الخيارات** وحدد **الخيار الأنسب** بناءً على:
          - أفضل الممارسات لنوع المشروع
          - الأنماط الشائعة في التطبيقات المماثلة
          - تقليل المخاطر (الأمان، الأداء، قابلية الصيانة)
          - المحاذاة مع أي أهداف صريحة للمشروع أو قيود مرئية في المواصفات
       - اعرض **خيارك الموصى به بشكل بارز** في الأعلى مع تبرير واضح (1-2 جمل تشرح سبب كونه الخيار الأفضل).
       - التنسيق: `**موصى به:** الخيار [X] - <التبرير>`
       - ثم اعرض جميع الخيارات كجدول Markdown:

       | خيار | الوصف |
       |---|---|
       | أ | <وصف الخيار أ> |
       | ب | <وصف الخيار ب> |
       | ج | <وصف الخيار ج> (أضف د/هـ حسب الحاجة حتى 5) |
       | قصير | قدم إجابة قصيرة مختلفة (<=5 كلمات) (ضمن فقط إذا كان البديل الحر مناسباً) |

       - بعد الجدول، أضف: `يمكنك الرد بحرف الخيار (مثلاً، "أ")، قبول التوصية بقول "نعم" أو "موصى به"، أو تقديم إجابتك القصيرة الخاصة.`
    - لنمط الإجابة القصيرة (لا توجد خيارات منفصلة ذات مغزى):
       - قدم **إجابتك المقترحة** بناءً على أفضل الممارسات والسياق.
       - التنسيق: `**مقترح:** <إجابتك المقترحة> - <تبرير موجز>`
       - ثم أخرج: `التنسيق: إجابة قصيرة (<=5 كلمات). يمكنك قبول الاقتراح بقول "نعم" أو "مقترح"، أو تقديم إجابتك الخاصة.`
    - بعد إجابة المستخدم:
       - إذا رد المستخدم بـ "نعم"، "موصى به"، أو "مقترح"، استخدم توصيتك/اقتراحك المذكور سابقاً كإجابة.
       - خلاف ذلك، تحقق من أن الإجابة تعين لخيار واحد أو تناسب قيد <=5 كلمات.
       - إذا كان غامضاً، اطلب توضيحاً سريعاً (العد لا يزال ينتمي لنفس السؤال؛ لا تتقدم).
       - بمجرد الرضا، سجلها في الذاكرة العاملة (لا تكتب على القرص بعد) وانتقل للسؤال التالي في قائمة الانتظار.
    - توقف عن طرح المزيد من الأسئلة عندما:
       - يتم حل جميع الأمور الغامضة الحرجة مبكراً (تصبح العناصر المتبقية في قائمة الانتظار غير ضرورية)، أو
       - يشير المستخدم للاكتمال ("تم"، "جيد"، "لا مزيد")، أو
       - تصل إلى 5 أسئلة مطروحة.
    - لا تكشف أبداً عن الأسئلة المستقبلية في قائمة الانتظار مسبقاً.
    - إذا لم تكن هناك أسئلة صالحة في البداية، أبلغ فوراً عن عدم وجود أمور غامضة حرجة.

5. التكامل بعد كل إجابة مقبولة (نهج التحديث التزايدي):
    - حافظ على تمثيل في الذاكرة للمواصفات (محملة مرة واحدة في البداية) بالإضافة لمحتويات الملف الخام.
    - لأول إجابة مدمجة في هذه الجلسة:
       - تأكد من وجود قسم `## Clarifications` (أنشئه فقط بعد أعلى مستوى للسياق/النظرة العامة حسب قالب المواصفات إذا كان مفقوداً).
       - تحته، أنشئ (إذا لم يكن موجوداً) عنواناً فرعياً `### Session YYYY-MM-DD` لليوم.
    - ألحق سطر نقطي مباشرة بعد القبول: `- س: <السؤال> ← ج: <الإجابة النهائية>`.
    - ثم طبق التوضيح فوراً على القسم (الأقسام) الأنسب:
       - غموض وظيفي ← تحديث أو إضافة نقطة في المتطلبات الوظيفية.
       - تفاعل المستخدم / تمييز الفاعل ← تحديث قصص المستخدم أو قسم الفاعلين الفرعي (إذا وجد) بالدور الموضح، القيد، أو السيناريو.
       - شكل البيانات / الكيانات ← تحديث نموذج البيانات (إضافة حقول، أنواع، علاقات) مع الحفاظ على الترتيب؛ لاحظ القيود المضافة بإيجاز.
       - قيد غير وظيفي ← إضافة/تعديل معايير قابلة للقياس في قسم السمات غير الوظيفية / الجودة (تحويل الصفة الغامضة إلى مقياس أو هدف صريح).
       - حالة حدية / تدفق سلبي ← إضافة نقطة جديدة تحت الحالات الحدية / معالجة الأخطاء (أو إنشاء قسم فرعي لها إذا وفر القالب مكاناً لها).
       - تعارض المصطلحات ← توحيد المصطلح عبر المواصفات؛ الاحتفاظ بالأصلي فقط إذا لزم الأمر بإضافة `(كان يشار إليه سابقاً بـ "X")` مرة واحدة.
    - إذا أبطل التوضيح عبارة غامضة سابقة، استبدل تلك العبارة بدلاً من التكرار؛ لا تترك نصاً متناقضاً قديماً.
    - احفظ ملف المواصفات بعد كل تكامل لتقليل مخاطر فقدان السياق (كتابة ذرية).
    - حافظ على التنسيق: لا تعد ترتيب الأقسام غير ذات الصلة؛ حافظ على التسلسل الهرمي للعناوين سليماً.
    - اجعل كل توضيح مدرج ضئيلاً وقابلاً للاختبار (تجنب السرد الطويل).

6. التحقق (يتم تنفيذه بعد كل كتابة بالإضافة للمرور النهائي):
   - جلسة التوضيحات تحتوي على نقطة واحدة بالضبط لكل إجابة مقبولة (لا تكرارات).
   - إجمالي الأسئلة المطروحة (المقبولة) ≤ 5.
   - الأقسام المحدثة لا تحتوي على عناصر نائبة غامضة باقية كان من المفترض أن تحلها الإجابة الجديدة.
   - لا تتبقى عبارة سابقة متناقضة (مسح للخيارات البديلة غير الصالحة الآن التي تمت إزالتها).
   - هيكل Markdown صالح؛ العناوين الجديدة المسموحة فقط: `## Clarifications`, `### Session YYYY-MM-DD`.
   - اتساق المصطلحات: استخدام نفس المصطلح القانوني عبر جميع الأقسام المحدثة.

7. اكتب المواصفات المحدثة مرة أخرى إلى `FEATURE_SPEC`.

8. تقرير الانتهاء (بعد انتهاء حلقة الاستجواب أو الإنهاء المبكر):
   - عدد الأسئلة المطروحة والمجابة.
   - مسار المواصفات المحدثة.
   - الأقسام التي تم لمسها (سرد الأسماء).
   - جدول ملخص التغطية يسرد كل فئة تصنيف مع الحالة: تم الحل (كان جزئي/مفقود وتمت معالجته)، مؤجل (تجاوز حصة الأسئلة أو أنسب للتطوير)، واضح (كافٍ بالفعل)، معلق (لا يزال جزئي/مفقود لكن تأثيره منخفض).
   - إذا بقي أي معلق أو مؤجل، أوصِ بما إذا كان يجب المتابعة إلى `/speckit.plan` أو تشغيل `/speckit.clarify` مرة أخرى لاحقاً بعد التخطيط.
   - الأمر التالي المقترح.

قواعد السلوك:

- إذا لم يتم العثور على أي غموض ذي مغزى (أو جميع الأسئلة المحتملة ستكون منخفضة التأثير)، رد: "لم يتم الكشف عن غموض حرج يستحق التوضيح الرسمي." واقترح المتابعة.
- إذا كان ملف المواصفات مفقوداً، وجه المستخدم لتشغيل `/speckit.specify` أولاً (لا تنشئ مواصفات جديدة هنا).
- لا تتجاوز أبداً 5 أسئلة إجمالية مطروحة (إعادة محاولات التوضيح لسؤال واحد لا تحسب كأسئلة جديدة).
- تجنب الأسئلة التخمينية حول المكدس التقني ما لم يمنع غيابها الوضوح الوظيفي.
- احترم إشارات الإنهاء المبكر للمستخدم ("توقف"، "تم"، "تابع").
- إذا لم يتم طرح أسئلة بسبب التغطية الكاملة، أخرج ملخص تغطية مضغوط (جميع الفئات واضحة) ثم اقترح التقدم.
- إذا تم الوصول للحصة مع بقاء فئات عالية التأثير غير محلولة، ضع علامة صريحة عليها تحت "مؤجل" مع المبرر.

سياق لتحديد الأولويات: $ARGUMENTS
