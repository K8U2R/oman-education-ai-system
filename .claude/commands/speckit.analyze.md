---
description: إجراء تحليل غير مدمر لاتساق وجودة المستندات عبر spec.md و plan.md و tasks.md بعد توليد المهام.
---

## مدخلات المستخدم (User Input)

```text
$ARGUMENTS
```

يجب عليك **مراعاة** مدخلات المستخدم قبل المتابعة (إذا لم تكن فارغة).

## الهدف (Goal)

تحديد التناقضات، التكرارات، الغموض، والعناصر غير المحددة بدقة عبر المستندات الأساسية الثلاثة (`spec.md`, `plan.md`, `tasks.md`) قبل التنفيذ. يجب تشغيل هذا الأمر فقط بعد نجاح `/speckit.tasks` في إنتاج ملف `tasks.md` كامل.

## قيود التشغيل (Operating Constraints)

**للقراءة فقط بصرامة (STRICTLY READ-ONLY)**: لا **تقم** بتعديل أي ملفات. قم بإخراج تقرير تحليل مهيكل. اعرض خطة تصحيح اختيارية (يجب على المستخدم الموافقة صراحةً قبل استدعاء أي أوامر تحرير يدوية لاحقاً).

**سلطة الدستور (Constitution Authority)**: دستور المشروع (`.specify/memory/constitution.md`) **غير قابل للتفاوض** ضمن نطاق هذا التحليل. تعارضات الدستور تعتبر تلقائياً حرجة (CRITICAL) وتتطلب تعديل المواصفات، الخطة، أو المهام—وليس تخفيفاً أو إعادة تفسير أو تجاهلاً صامتاً للمبدأ. إذا كان المبدأ نفسه بحاجة للتغيير، يجب أن يتم ذلك في تحديث منفصل وصريح للدستور خارج `/speckit.analyze`.

## خطوات التنفيذ (Execution Steps)

### 1. تهيئة سياق التحليل

شغل `.specify/scripts/bash/check-prerequisites.sh --json --require-tasks --include-tasks` مرة واحدة من جذر المستودع وقم بتحليل JSON للحصول على `FEATURE_DIR` وقائمة `AVAILABLE_DOCS`. استنتج المسارات المطلقة:

- SPEC = FEATURE_DIR/spec.md
- PLAN = FEATURE_DIR/plan.md
- TASKS = FEATURE_DIR/tasks.md

توقف مع رسالة خطأ إذا كان أي ملف مطلوب مفقوداً (وجه المستخدم لتشغيل أمر المتطلبات المفقودة).
للاقتباسات الفردية في الوسائط مثل "I'm Groot"، استخدم صيغة الهروب: مثال `'I'\''m Groot'` (أو اقتباس مزدوج إذا أمكن: `"I'm Groot"`).

### 2. تحميل المستندات (الكشف التدريجي)

حمل فقط الحد الأدنى الضروري من السياق من كل مستند:

**من spec.md:**
- نظرة عامة/السياق
- المتطلبات الوظيفية
- المتطلبات غير الوظيفية
- قصص المستخدم
- الحالات الحدية (Edge Cases) (إذا وجدت)

**من plan.md:**
- الهيكل/خيارات المكدس
- مراجع نموذج البيانات
- المراحل
- القيود التقنية

**من tasks.md:**
- معرفات المهام
- الأوصاف
- تجميع المراحل
- علامات التوازي [P]
- مسارات الملفات المشار إليها

**من الدستور:**
- حمل `.specify/memory/constitution.md` للتحقق من المبادئ

### 3. بناء النماذج الدلالية

أنشئ تمثيلات داخلية (لا تضمن المستندات الخام في الإخراج):

- **جرد المتطلبات**: كل متطلب وظيفي + غير وظيفي بمفتاح ثابت (اشتق اختصاراً بناءً على العبارة الأمرية؛ مثل "User can upload file" ← `user-can-upload-file`)
- **جرد قصص المستخدم/الإجراءات**: إجراءات مستخدم منفصلة مع معايير القبول
- **خريطة تغطية المهام**: اربط كل مهمة بمتطلب واحد أو أكثر أو قصة (الاستدلال بالكلمات المفتاحية / أنماط مرجعية صريحة مثل المعرفات أو العبارات الرئيسية)
- **مجموعة قواعد الدستور**: استخرج أسماء المبادئ وعبارات MUST/SHOULD الإلزامية

### 4. جولات الكشف (تحليل فعال للرموز)

ركز على النتائج عالية الإشارة. حدد 50 نتيجة كحد أقصى؛ جمع الباقي في ملخص الفائض.

#### أ. كشف التكرار (Duplication)
- حدد المتطلبات شبه المتطابقة
- ضع علامة على الصياغة منخفضة الجودة للدمج

#### ب. كشف الغموض (Ambiguity)
- ضع علامة على الصفات الغامضة (سريع، قابل للتوسع، آمن، بديهي، قوي) التي تفتقر لمعايير قابلة للقياس
- ضع علامة على العناصر النائبة غير المحلولة (TODO, TKTK, ???, `<placeholder>`, إلخ)

#### ج. نقص التحديد (Underspecification)
- متطلبات بأفعال ولكن تفتقد المفعول به أو النتيجة القابلة للقياس
- قصص مستخدم تفتقد محاذاة معايير القبول
- مهام تشير إلى ملفات أو مكونات غير معرفة في spec/plan

#### د. توافق الدستور (Constitution Alignment)
- أي متطلب أو عنصر خطة يتعارض مع مبدأ "إلزامي" (MUST)
- أقسام إلزامية مفقودة أو بوابات جودة من الدستور

#### هـ. فجوات التغطية (Coverage Gaps)
- متطلبات بصفر مهام مرتبطة
- مهام بلا متطلب/قصة مرتبطة
- متطلبات غير وظيفية لا تنعكس في المهام (مثل الأداء، الأمان)

#### و. عدم الاتساق (Inconsistency)
- انحراف المصطلحات (نفس المفهوم مسمى بشكل مختلف عبر الملفات)
- كيانات بيانات مشار إليها في الخطة ولكن غائبة في المواصفات (أو العكس)
- تناقضات ترتيب المهام (مثل مهام التكامل قبل مهام الإعداد التأسيسية دون ملاحظة تبعية)
- متطلبات متعارضة (مثل واحدة تتطلب Next.js بينما الأخرى تحدد Vue)

### 5. تعيين الشدة (Severity)

استخدم هذا النهج الاستباقي لتحديد أولويات النتائج:

- **حرج (CRITICAL)**: ينتهك "إلزامي" (MUST) في الدستور، مستند مواصفات أساسي مفقود، أو متطلب بصفر تغطية يمنع الوظائف الأساسية
- **عالي (HIGH)**: متطلب مكرر أو متعارض، سمة أمان/أداء غامضة، معيار قبول غير قابل للاختبار
- **متوسط (MEDIUM)**: انحراف المصطلحات، تغطية مهام غير وظيفية مفقودة، حالة حدية غير محددة بدقة
- **منخفض (LOW)**: تحسينات في الأسلوب/الصياغة، تكرار طفيف لا يؤثر على ترتيب التنفيذ

### 6. إنتاج تقرير تحليل مدمج

أخرج تقرير Markdown (بدون كتابة ملفات) بالهيكل التالي:

## تقرير تحليل المواصفات (Specification Analysis Report)

| المعرف | الفئة | الشدة | الموقع (المواقع) | الملخص | التوصية |
|----|----------|----------|-------------|---------|----------------|
| A1 | تكرار | عالي | spec.md:L120-134 | متطلبان متشابهان ... | دمج الصياغة؛ الاحتفاظ بالنسخة الأوضح |

(أضف صفاً واحداً لكل نتيجة؛ ولد معرفات ثابتة مسبوقة بحرف الفئة.)

**جدول ملخص التغطية:**

| مفتاح المتطلب | هل توجد مهمة؟ | معرفات المهام | ملاحظات |
|-----------------|-----------|----------|-------|

**قضايا توافق الدستور:** (إن وجدت)

**مهام غير مرتبطة:** (إن وجدت)

**المقاييس (Metrics):**

- إجمالي المتطلبات
- إجمالي المهام
- نسبة التغطية % (متطلبات مع >=1 مهمة)
- عدد الغموض
- عدد التكرار
- عدد القضايا الحرجة

### 7. تقديم الإجراءات التالية

في نهاية التقرير، أخرج كتلة إجراءات تالية موجزة:

- إذا وجدت قضايا **حرجة**: أوصِ بحلها قبل `/speckit.implement`
- إذا وجدت فقط **منخفض/متوسط**: يمكن للمستخدم المتابعة، لكن قدم اقتراحات للتحسين
- قدم اقتراحات أوامر صريحة: مثل "شغل /speckit.specify مع التحسين"، "شغل /speckit.plan لتعديل الهندسة"، "حرر tasks.md يدوياً لإضافة تغطية لـ 'مقاييس الأداء'"

### 8. عرض التصحيح

اسأل المستخدم: "هل ترغب في أن أقترح تعديلات تصحيحية ملموسة لأهم N قضايا؟" (لا تطبقها تلقائياً.)

## مبادئ التشغيل (Operating Principles)

### كفاءة السياق
- **الحد الأدنى من الرموز عالية الإشارة**: ركز على النتائج القابلة للتنفيذ، وليس التوثيق الشامل
- **الكشف التدريجي**: تحميل المستندات بشكل تدريجي؛ لا تفرغ كل المحتوى في التحليل
- **إخراج فعال للرموز**: حد جدول النتائج بـ 50 صفاً؛ لخص الفائض
- **نتائج حتمية**: إعادة التشغيل دون تغييرات يجب أن تنتج معرفات وأعداداً متسقة

### إرشادات التحليل
- **لا تقم أبداً بتعديل الملفات** (هذا تحليل للقراءة فقط)
- **لا تهلوس أبداً أقساماً مفقودة** (إذا كانت غائبة، أبلغ عنها بدقة)
- **رتب أولويات انتهاكات الدستور** (هذه دائماً حرجة)
- **استخدم الأمثلة بدلاً من القواعد الشاملة** (استشهد بحالات محددة، وليس أنماطاً عامة)
- **أبلغ عن صفر قضايا بأناقة** (أصدر تقرير نجاح مع إحصائيات التغطية)

## السياق (Context)

$ARGUMENTS
