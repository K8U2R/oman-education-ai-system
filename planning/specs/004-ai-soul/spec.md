# مواصفات الميزة: AI Soul (Education & Development Core)

**فرع الميزة**: `004-ai-soul`  
**تاريخ الإنشاء**: 2026-02-04  
**الحالة**: مسودة (Draft)  
**المدخلات**: وصف المستخدم: "Activate AI Core using strict SpecKit protocols"

## سيناريوهات المستخدم والاختبار *(إلزامي)* (User Scenarios & Testing)

<!--
  هام: يجب تحديد أولويات قصص المستخدم كرحلات مستخدم مرتبة حسب الأهمية.
-->

### قصة المستخدم 1 - توليد الدروس التعليمية (الأولوية: P1)

بصفتي **معلمًا**، أريد **توليد خطط دروس ومحتوى تعليمي تلقائيًا** بناءً على المنهج العماني، لكي **أوفر الوقت وأضمن جودة المحتوى**.

**لماذا هذه الأولوية**: هذه هي القيمة الجوهرية للنظام ("التعليم"). المعلمون هم المستخدمون الأساسيون.

**اختبار مستقل**: يمكن اختبار خدمة التوليد عبر Unit Tests مع Mock LLM، وعبر Integration Tests تتحقق من تخزين الدرس المولد في قاعدة البيانات بهيكل صحيح (JSON).

**سيناريوهات القبول**:

1. **نظراً لـ** توفر نموذج AI محلي، **عندما** يطلب المعلم درسًا عن "الكسور" للصف الرابع، **إذن** يقوم النظام بتوليد خطة درس كاملة (أهداف، محتوى، تقويم) باللغة العربية.
2. **نظراً لـ** عدم توفر خدمة AI، **عندما** يطلب المعلم درسًا، **إذن** يظهر النظام رسالة خطأ واضحة "الخدمة غير متاحة حاليًا" دون انهيار.

---

### قصة المستخدم 2 - المساعد البرمجي للطلاب (الأولوية: P2)

بصفتي **طالبًا يتعلم البرمجة**، أريد **الحصول على مراجعة للكود وتصحيح الأخطاء** من مساعد AI، لكي **أفهم أخطائي وأتحسن دون انتظار المعلم**.

**لماذا هذه الأولوية**: دعم التعلم الذاتي وتمكين ميزة "المشاريع".

**اختبار مستقل**: إرسال مقتطفات برمجية خاطئة (Python/JS) لخدمة الـ AI والتحقق من أن الرد يحتوي على (1) تحديد الخطأ (2) الشرح (3) الكود المصحح.

**سيناريوهات القبول**:

1. **نظراً لـ** كود يحتوي على خطأ Syntax، **عندما** يطلب الطالب "تحليل الكود"، **إذن** يوضح الـ AI السطر الذي يحتوي على الخطأ ويقترح التصحيح.
2. **نظراً لـ** كود صحيح ولكن غير فعال، **عندما** يطلب الطالب "تحسين"، **إذن** يقترح الـ AI تحسينات في الأداء أو الأسلوب.

---

### الحالات الحدية (Edge Cases)

- ماذا يحدث عند **فشل الاتصال بنموذج AI المحلي** (Ollama down)؟ -> يجب تفعيل الـ Retry مع Exponential Backoff ثم الفشل الآمن.
- كيف يتعامل النظام مع **مدخلات مسيئة أو خارج السياق**؟ -> تطبيق Guardrails عند المدخلات والمخرجات (فلترة المحتوى).
- ماذا يحدث عند **طلب درس طويل جداً** يتجاوز Context Window؟ -> تقسيم الطلب (Chained Prompts) أو تلخيص المخرجات.

## المتطلبات *(إلزامي)* (Requirements)

### المتطلبات الوظيفية

- **FR-001**: النظام يجب أن (MUST) يتكامل مع خادم Ollama المحلي عبر واجهة موحدة (AIProvider Interface).
- **FR-002**: النظام يجب أن (MUST) يدعم النماذج الداعمة للغة العربية بطلاقة (مثل DeepSeek-R1 أو Qwen).
- **FR-003**: المعلمون يجب أن يكونوا قادرين على (MUST) تخصيص معلمات التوليد (المادة، الصف، نوع المحتوى).
- **FR-004**: النظام يجب أن (MUST) يخزن سجلات المحادثات التعليمية لأغراض المراجعة والتحسين (مع احترام الخصوصية).

### المتطلبات غير الوظيفية (الأمن والأداء)

- **NFR-001 (السيادة)**: معالجة البيانات يجب أن (MUST) تتم بالكامل محلياً (On-Premise / Localhost). يمنع الاتصال بـ APIs خارجية (OpenAI, Anthropic) للبيانات الحساسة.
- **NFR-002 (الأداء)**: زمن الاستجابة لتوليد الدرس الكامل يجب أن لا يتجاوز 30 ثانية (Streaming Response مفضل).

### الكيانات الرئيسية *(تضمين إذا كانت الميزة تتضمن بيانات)* (Key Entities)

- **[LessonDraft]**: مسودة الدرس المولد (محتوى JSON، الحالة، المعلم الطالب).
- **[AIChatSession]**: جلسة محادثة (رسائل، سياق، مستخدم).

## معايير النجاح *(إلزامي)* (Success Criteria)

### نتائج قابلة للقياس

- **SC-001**: نجاح 95% من طلبات توليد الدروس دون أخطاء تقنية.
- **SC-002**: تقييم جودة المحتوى المولد (بواسطة المعلمين) لا يقل عن 4/5 نجوم.
- **SC-003**: زمن الاستجابة الأول (TTFT) للمحادثة أقل من 2 ثانية.
