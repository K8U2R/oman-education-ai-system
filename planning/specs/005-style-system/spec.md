# المواصفات: نظام الأنماط السيادي (S3)

## 1. المقدمة
**نظام الأنماط السيادي (S3)** هو إعادة هيكلة معمارية لأنماط الواجهة الأمامية (Frontend). يهدف النظام إلى القضاء على "ازدواجية الحقيقة" (Split Truth) بين Tailwind و SCSS، وفرض استخدام مساحات ألوان **OKLCH** للحصول على دقة عالية في السمات (Themes)، وتطبيق طبقة صارمة من "السيادة التخطيطية" (Plan Sovereignty) حيث يتم تفعيل الميزات البصرية برمجياً بناءً على فئة اشتراك المستخدم.

## 2. قصص المستخدم (User Stories)
- **كمطور**، أريد **مصدر حقيقة واحد** (Single Source of Truth) لرموز التصميم التفصيلية (الألوان، المسافات، نصف القطر) حتى لا أضطر لتعريفها مرتين في `index.css` و `main.scss`.
- **كمطور**، أريد أن يعمل استيراد المتغيرات `import { variables } from 'sass'` في كل مكون، بحيث يعكس نفس القيم الموجودة في فئات Tailwind تماماً.
- **كمالك للمنتج**، أريد أن تتغير واجهة المستخدم تلقائياً لتعكس "الفخامة" (تدرجات لونية، زجاجية Glassmorphism، لمسات ذهبية) بناءً على اشتراك المستخدم دون الحاجة لكتابة شروط `if/else` يدوياً في كل مكون.
- **كمصمم**، أريد استخدام مساحة الألوان **OKLCH** لضمان سطوع إدراكي متسق عبر درجات الألوان المختلفة (ألوان الهوية العمانية).

## 3. المتطلبات التقنية

### 3.1 المعمارية الأساسية (الثلاثية - The Trifecta)
يجب أن يقوم النظام بمزامنة ثلاث طبقات بشكل مثالي:
1.  **رموز SASS (Tokens)**: التعريف الرياضي لنظام التصميم (خرائط OKLCH).
2.  **خصائص CSS المخصصة (Custom Properties)**: آلية التسليم وقت التشغيل (Native Variables).
3.  **تكوين Tailwind**: مولد فئات الخدمات (الذي يستهلك متغيرات CSS).

### 3.2 معيار هيكلة الملفات
```text
apps/frontend/src/styles/
├── abstracts/
│   ├── _tokens.scss       # الحقيقة الواحدة: خرائط ألوان OKLCH والمقاييس
│   ├── _variables.scss    # المخططات: ربط متغيرات SASS بمتغيرات CSS (مثلاً $primary -> var(--primary))
│   └── _mixins.scss       # المساعدات: بوابات الفئات (Tier Gating) واستعلامات الوسائط
├── engine/
│   └── _generator.scss    # الخوارزمية: حلقات تكرارية تحول الرموز إلى متغيرات CSS
├── themes/
│   ├── _sovereign.scss    # الأزرق العميق/الذهبي (الهوية العمانية)
│   └── _playful.scss      # ساطع/دائري (هوية الأطفال)
└── main.scss              # نقطة الإدخال (Entry Point)
```

### 3.3 صلاحية CSS الصارمة
- **مرفوض**: `color: var(--primary)` حيث تكون قيمة `--primary` مجرد أرقام (`263 50%`).
- **مقبول**: `color: hsl(var(--primary))` أو `color: var(--primary-color)` حيث يحتوي المتغير على دالة اللون.
- **القرار**: سنستخدم **القيم غير المغلفة** (Unwrapped Values - القنوات فقط) بالنسبة لـ HSL للسماح لمعدلات الشفافية في Tailwind بالعمل (`bg-primary/50`)، ولكن يجب توفير **Mixins مساعدة** أو **متغيرات مغلفة** لاستخدام SASS.

### 3.4 سيادة الفئات (Tier Sovereignty)
- استخدام محددات `body[data-tier="premium"]`.
- الفئة المميزة (Premium) تفعّل:
    - خلفيات زجاجية (Glassmorphism).
    - تدرجات شبكية (Mesh Gradients).
    - حدود متحركة (لمعان ذهبي).

## 4. معايير القبول (Acceptance Criteria)
1.  **الترابط الشامل**: أي متغير يتم تعريفه في `_tokens.scss` يجب أن يكون قابلاً للاستخدام في مكون React عبر Tailwind (`bg-primary`) وعبر وحدة SCSS (`background: $primary`).
2.  **عدم التكرار**: يجب ألا يحتوي ملف `index.css` على أي تعريفات `:root`. يتم توليد جميع المتغيرات بواسطة SASS.
3.  **بوابات الاشتراك (Plan Gating)**: تغيير فئة المستخدم في السياق/المخزن (Store) يؤدي فوراً لتحديث الخصائص البصرية (مثلاً، يصبح نصف القطر أكثر دقة، وتصبح الظلال أعمق).
4.  **إصلاح التدقيق**: حل مشكلة "سلسلة المتغيرات المكسورة" التي تم تحديدها في تقرير الفحص.

## 5. المخاطر والتخفيف
- **الخطر**: قد يتوقف الإكمال التلقائي في Tailwind (IntelliSense) إذا لم يتمكن من حل المتغيرات الديناميكية.
    - *التخفيف*: وضع قيم احتياطية (Fallback) في `tailwind.config.ts`.
- **الخطر**: دعم المتصفحات لـ OKLCH.
    - *التخفيف*: تراجع تلقائي (Fallback) إلى HSL أو RGB إذا لزم الأمر (أو افتراض متصفحات حديثة كحد أدنى وفقاً لدستور المشروع).
