# القانون 14: المنطق التجاري وسيادة الباقة (Commercial Logic & Tier Supremacy)

**الحالة**: نشط
**تاريخ التفعيل**: 2026-01-28
**الأولوية**: حرجة
**المجال**: منطق الأعمال والتحكم في الوصول

## نظرة عامة
يحكم هذا القانون المنطق التجاري لنموذج البرمجيات كخدمة (SaaS) الموحد. وهو يرسخ مبدأ أن قدرات المستخدم تحدد حصراً بناءً على **باقة الاشتراك (Subscription Tier)** الخاصة به، وليس بناءً على أدوار عشوائية أو تصنيفات قديمة.

## المواد (Articles)

### المادة 1: سيادة الباقة (Tier Supremacy)
*   **المبدأ**: يتم تحديد قوة المستخدم، حدوده، والميزات المتاحة له **حصراً** بناءً على `PlanTier` الحالي الخاص به.
*   **القاعدة**: يحظر على الكود التحقق من أدوار مثل "Student" أو "Teacher" لتحديد الوصول للميزات (مثلاً: `if (user.role == 'student')` ممنوع تماماً لغرض تقييد الميزات). بدلاً من ذلك، يجب التحقق من أعلام القدرات (Capability Flags) المشتقة من الباقة (مثلاً: `if (user.canAccess('code_generation'))`).
*   **استثناء**: الأدوار الإدارية (Admin, SuperAdmin) قد تتجاوز هذه التحققات لأغراض الصيانة فقط.

### المادة 2: بوابات الميزات والحصص (Feature Gating & Quotas)
*   **المبدأ**: الموارد المكلفة يجب أن تكون محمية ومقيدة وبوابات.
*   **القاعدة**: لا يجوز تنفيذ أي استدعاء لخدمة مكلفة (توليد ذكاء اصطناعي، نشر سحابي، تخصيص تخزين) دون:
    1.  التحقق أولاً من حالة اشتراك المستخدم النشطة.
    2.  التحقق من أن المستخدم لم يتجاوز الحصة (Quota) المحددة له لتلك الفترة.
*   **التنفيذ**: استخدم وسيط مركزي `QuotaManager` أو `UsageTracker` قبل منطق المتحكم (Controller).

### المادة 3: التسعير الديناميكي (Dynamic Pricing)
*   **المبدأ**: التسعير هو بيانات أعمال، وليس كود تطبيق.
*   **القاعدة**: يُمنع منعاً باتاً كتابة الأسعار أو الخصومات داخل الكود (Hardcoding).
*   **المتطلب**: يجب جلب جميع الأسعار، النسب المئوية، وقواعد الخصم من:
    *   جدول تكوين في قاعدة البيانات.
    *   خدمة تكوين عن بعد (مثل Stripe أو محرك خصومات متخصص).
*   **السبب**: يجب أن تتمكن فرق التسويق من تعديل استراتيجيات التسعير دون الحاجة لنشر تحديثات برمجية هندسية.

## الإنفاذ (Enforcement)
*   **مراجعة الكود**: سيتم رفض أي طلب سحب (PR) يقدم أسعاراً ثابتة أو تقييداً للميزات بناءً على الدور.
*   **التدقيق**: يجب إجراء فحوصات آلية منتظمة لضمان عدم وجود "أرقام سحرية" (Magic Numbers) متعلقة بالعملات في قاعدة الكود.
