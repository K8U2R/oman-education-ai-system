{
  "openapi": "3.0.0",
  "info": {
    "title": "Oman Education AI System API",
    "version": "1.0.0",
    "description": "API documentation for the Oman Education AI System Backend"
  },
  "servers": [
    {
      "url": "http://localhost:3000/api/v1",
      "description": "Development server"
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    }
  },
  "security": [
    {
      "bearerAuth": []
    }
  ],
  "paths": {
    "/api/v1/auth/verify-email": {
      "post": {
        "summary": "التحقق من البريد الإلكتروني",
        "description": "التحقق من البريد باستخدام رمز التحقق",
        "tags": [
          "Authentication - Email"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "token"
                ],
                "properties": {
                  "token": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "تم التحقق بنجاح"
          },
          "400": {
            "description": "رمز التحقق غير صالح"
          }
        }
      }
    },
    "/api/v1/auth/send-verification": {
      "post": {
        "summary": "إرسال بريد التحقق",
        "description": "إعادة إرسال بريد التحقق",
        "tags": [
          "Authentication - Email"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "email"
                ],
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "تم إرسال البريد"
          },
          "404": {
            "description": "البريد غير موجود"
          }
        }
      }
    },
    "/api/v1/auth/login": {
      "post": {
        "summary": "تسجيل الدخول",
        "description": "تسجيل الدخول باستخدام البريد الإلكتروني وكلمة المرور",
        "tags": [
          "Authentication - Login"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "email",
                  "password"
                ],
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email",
                    "example": "user@example.com"
                  },
                  "password": {
                    "type": "string",
                    "minLength": 8,
                    "example": "SecurePass123"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "تسجيل الدخول نجح",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/LoginResponse"
                }
              }
            }
          },
          "401": {
            "description": "فشل تسجيل الدخول"
          },
          "429": {
            "description": "تم تجاوز الحد الأقصى للمحاولات"
          }
        }
      }
    },
    "/api/v1/auth/logout": {
      "post": {
        "summary": "تسجيل الخروج",
        "description": "تسجيل خروج المستخدم وإلغاء الجلسة الحالية",
        "tags": [
          "Authentication - Login"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "تم تسجيل الخروج بنجاح"
          },
          "401": {
            "description": "غير مصرح"
          }
        }
      }
    },
    "/api/v1/auth/logout-all": {
      "post": {
        "summary": "تسجيل الخروج من جميع الأجهزة",
        "description": "تسجيل خروج المستخدم من جميع الجلسات",
        "tags": [
          "Authentication - Login"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "تم تسجيل الخروج من جميع الأجهزة"
          },
          "401": {
            "description": "غير مصرح"
          }
        }
      }
    },
    "/api/v1/auth/oauth/{provider}": {
      "get": {
        "summary": "بدء عملية OAuth",
        "description": "توجيه المستخدم إلى صفحة تسجيل الدخول لـ OAuth provider (Google, GitHub)",
        "tags": [
          "Authentication - OAuth"
        ],
        "parameters": [
          {
            "in": "path",
            "name": "provider",
            "required": true,
            "schema": {
              "type": "string",
              "enum": [
                "google",
                "github"
              ]
            },
            "description": "OAuth provider"
          },
          {
            "in": "query",
            "name": "redirect_to",
            "schema": {
              "type": "string",
              "format": "uri"
            },
            "description": "URL للعودة بعد تسجيل الدخول"
          }
        ],
        "responses": {
          "302": {
            "description": "توجيه إلى صفحة تسجيل الدخول لـ OAuth provider"
          },
          "400": {
            "description": "Provider غير مدعوم",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/auth/oauth/{provider}/callback": {
      "get": {
        "summary": "معالجة OAuth Callback",
        "description": "معالجة callback من OAuth provider بعد تسجيل الدخول",
        "tags": [
          "Authentication - OAuth"
        ],
        "parameters": [
          {
            "in": "path",
            "name": "provider",
            "required": true,
            "schema": {
              "type": "string",
              "enum": [
                "google",
                "github"
              ]
            },
            "description": "OAuth provider"
          },
          {
            "in": "query",
            "name": "code",
            "schema": {
              "type": "string"
            },
            "description": "Authorization code من OAuth provider"
          },
          {
            "in": "query",
            "name": "state",
            "schema": {
              "type": "string"
            },
            "description": "State parameter للتحقق من الأمان"
          }
        ],
        "responses": {
          "302": {
            "description": "توجيه إلى Frontend مع tokens"
          },
          "400": {
            "description": "فشل عملية OAuth",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/auth/update-password": {
      "put": {
        "summary": "تحديث كلمة المرور",
        "description": "تحديث كلمة مرور المستخدم المصادق عليه",
        "tags": [
          "Authentication - Password"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "current_password",
                  "new_password"
                ],
                "properties": {
                  "current_password": {
                    "type": "string"
                  },
                  "new_password": {
                    "type": "string",
                    "minLength": 8
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "تم تحديث كلمة المرور"
          },
          "401": {
            "description": "كلمة المرور الحالية خاطئة"
          }
        }
      }
    },
    "/api/v1/auth/register": {
      "post": {
        "summary": "التسجيل (إنشاء حساب جديد)",
        "description": "إنشاء حساب مستخدم جديد. سيتم إرسال بريد التحقق تلقائياً.",
        "tags": [
          "Authentication - Register"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "email",
                  "password"
                ],
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email"
                  },
                  "password": {
                    "type": "string",
                    "minLength": 8
                  },
                  "first_name": {
                    "type": "string"
                  },
                  "last_name": {
                    "type": "string"
                  },
                  "username": {
                    "type": "string"
                  },
                  "role": {
                    "type": "string",
                    "enum": [
                      "student",
                      "admin",
                      "parent",
                      "developer"
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "تم إنشاء الحساب بنجاح"
          },
          "409": {
            "description": "المستخدم موجود بالفعل"
          }
        }
      }
    },
    "/api/v1/auth/refresh": {
      "post": {
        "summary": "تحديث رمز الوصول",
        "description": "الحصول على رمز وصول جديد باستخدام رمز التحديث",
        "tags": [
          "Authentication - Token"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "refresh_token"
                ],
                "properties": {
                  "refresh_token": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "تم تحديث الرمز بنجاح"
          },
          "401": {
            "description": "رمز التحديث غير صالح"
          }
        }
      }
    },
    "/api/v1/auth/me": {
      "get": {
        "summary": "الحصول على معلومات المستخدم الحالي",
        "description": "جلب معلومات المستخدم المصادق عليه",
        "tags": [
          "Authentication - Token"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "معلومات المستخدم",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/User"
                }
              }
            }
          },
          "401": {
            "description": "غير مصرح"
          }
        }
      }
    },
    "/api/v1/projects": {
      "get": {
        "summary": "جلب جميع المشاريع",
        "description": "استرجاع قائمة المشاريع مع دعم الفلاتر والتقسيم للصفحات",
        "tags": [
          "Projects"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "type",
            "schema": {
              "type": "string",
              "enum": [
                "educational",
                "research",
                "assignment",
                "presentation"
              ]
            },
            "description": "نوع المشروع"
          },
          {
            "in": "query",
            "name": "status",
            "schema": {
              "type": "string",
              "enum": [
                "draft",
                "in_progress",
                "completed",
                "archived"
              ]
            },
            "description": "حالة المشروع"
          },
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer",
              "default": 1
            },
            "description": "رقم الصفحة"
          },
          {
            "in": "query",
            "name": "per_page",
            "schema": {
              "type": "integer",
              "default": 20
            },
            "description": "عدد العناصر في الصفحة"
          }
        ],
        "responses": {
          "200": {
            "description": "تم جلب المشاريع بنجاح",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/Success"
                    },
                    {
                      "type": "object",
                      "properties": {
                        "data": {
                          "type": "object",
                          "properties": {
                            "projects": {
                              "type": "array",
                              "items": {
                                "$ref": "#/components/schemas/Project"
                              }
                            },
                            "total": {
                              "type": "integer"
                            },
                            "page": {
                              "type": "integer"
                            },
                            "total_pages": {
                              "type": "integer"
                            }
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          }
        }
      },
      "post": {
        "summary": "إنشاء مشروع جديد",
        "description": "إنشاء مشروع تعليمي جديد",
        "tags": [
          "Projects"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateProjectRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "تم إنشاء المشروع بنجاح",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/Success"
                    },
                    {
                      "type": "object",
                      "properties": {
                        "data": {
                          "type": "object",
                          "properties": {
                            "project": {
                              "$ref": "#/components/schemas/Project"
                            }
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/projects/stats": {
      "get": {
        "summary": "إحصائيات المشاريع",
        "description": "الحصول على إحصائيات عامة عن المشاريع",
        "tags": [
          "Projects"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "تم جلب الإحصائيات بنجاح",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/Success"
                    },
                    {
                      "type": "object",
                      "properties": {
                        "data": {
                          "type": "object",
                          "properties": {
                            "stats": {
                              "$ref": "#/components/schemas/ProjectStats"
                            }
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/projects/{id}": {
      "get": {
        "summary": "عرض تفاصيل مشروع",
        "description": "الحصول على تفاصيل مشروع محدد",
        "tags": [
          "Projects"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "معرف المشروع"
          }
        ],
        "responses": {
          "200": {
            "description": "تم جلب المشروع بنجاح",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/Success"
                    },
                    {
                      "type": "object",
                      "properties": {
                        "data": {
                          "type": "object",
                          "properties": {
                            "project": {
                              "$ref": "#/components/schemas/Project"
                            }
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "404": {
            "description": "المشروع غير موجود",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      },
      "put": {
        "summary": "تحديث مشروع",
        "description": "تحديث بيانات مشروع موجود",
        "tags": [
          "Projects"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "معرف المشروع"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "title": {
                    "type": "string"
                  },
                  "description": {
                    "type": "string"
                  },
                  "status": {
                    "type": "string",
                    "enum": [
                      "draft",
                      "in_progress",
                      "completed",
                      "archived"
                    ]
                  },
                  "progress": {
                    "type": "number"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "تم تحديث المشروع بنجاح",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/Success"
                    },
                    {
                      "type": "object",
                      "properties": {
                        "data": {
                          "type": "object",
                          "properties": {
                            "project": {
                              "$ref": "#/components/schemas/Project"
                            }
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          }
        }
      },
      "delete": {
        "summary": "حذف مشروع",
        "description": "حذف مشروع نهائياً",
        "tags": [
          "Projects"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "معرف المشروع"
          }
        ],
        "responses": {
          "200": {
            "description": "تم حذف المشروع بنجاح",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Success"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/projects/{id}/progress": {
      "get": {
        "summary": "تقدم المشروع",
        "description": "عرض تفاصيل تقدم المشروع والمهام المنجزة",
        "tags": [
          "Projects"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "معرف المشروع"
          }
        ],
        "responses": {
          "200": {
            "description": "تم جلب التقدم بنجاح",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/Success"
                    },
                    {
                      "type": "object",
                      "properties": {
                        "data": {
                          "type": "object",
                          "properties": {
                            "progress": {
                              "type": "object",
                              "properties": {
                                "project_id": {
                                  "type": "string"
                                },
                                "progress_percentage": {
                                  "type": "number"
                                },
                                "completed_tasks": {
                                  "type": "number"
                                },
                                "total_tasks": {
                                  "type": "number"
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          }
        }
      }
    }
  },
  "tags": [
    {
      "name": "Projects",
      "description": "إدارة المشاريع التعليمية"
    }
  ]
}