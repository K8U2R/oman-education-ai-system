@use 'sass:map';
@use 'sass:string';

/**
 * Sovereign Design Tokens (OKLCH)
 * Single source of truth for the algorithmic design system.
 */

// 1. Base Palette Matrices (OKLCH)
// Omani Identity (University Persona)
$palette-sovereign: (
    'primary': string.unquote("oklch(0.285 0.05 260)"),
    // Deep Blue Identity
    'secondary': string.unquote("oklch(0.53 0.22 25)"),
    // Honor Red
    'success': string.unquote("oklch(0.55 0.18 142)"),
    // Growth Green
    'warning': string.unquote("oklch(0.80 0.15 85)"),
    // Alert Gold
    'error': string.unquote("oklch(0.55 0.22 25)"),
    // Error Red (same as secondary for consistency)
    'info': string.unquote("oklch(0.60 0.15 220)"),
    // Info Blue
    'white': string.unquote("oklch(1 0 0)"),
    'black': string.unquote("oklch(0 0 0)"),
    'gray-50': string.unquote("oklch(0.98 0.01 260)"),
    'gray-100': string.unquote("oklch(0.95 0.01 260)"),
    'gray-200': string.unquote("oklch(0.90 0.01 260)"),
    'gray-300': string.unquote("oklch(0.80 0.01 260)"),
    'gray-400': string.unquote("oklch(0.65 0.01 260)"),
    'gray-500': string.unquote("oklch(0.50 0.01 260)"),
    'gray-600': string.unquote("oklch(0.40 0.02 260)"),
    'gray-700': string.unquote("oklch(0.30 0.02 260)"),
    'gray-800': string.unquote("oklch(0.25 0.02 260)"),
    'gray-900': string.unquote("oklch(0.20 0.02 260)")
);

// Playful Identity (Children Persona)
$palette-playful: (
    'primary': string.unquote("oklch(0.65 0.18 250)"),
    // Playful Blue
    'secondary': string.unquote("oklch(0.70 0.20 20)"),
    // Playful Red
    'success': string.unquote("oklch(0.65 0.18 142)"),
    // Same Green usually
    'warning': string.unquote("oklch(0.85 0.16 85)"),
    'white': string.unquote("oklch(1 0 0)"),
    'black': string.unquote("oklch(0 0 0)"),
    'gray-50': string.unquote("oklch(0.99 0.01 90)"),
    'gray-900': string.unquote("oklch(0.20 0.02 260)")
);

// 2. Theme Configuration Map
// Defines semantic tokens for each mode/persona tuple
$themes-config: (
    'university': ('light': ('bg-app': map.get($palette-sovereign, 'gray-50'),
            'bg-surface': map.get($palette-sovereign, 'white'),
            'text-main': map.get($palette-sovereign, 'gray-900'),
            'text-inverse': map.get($palette-sovereign, 'white'),
            'primary': map.get($palette-sovereign, 'primary'),
            'secondary': map.get($palette-sovereign, 'secondary'),
            'border': string.unquote("oklch(0.92 0.01 260)"), // Light gray border
        ),
        'dark': ('bg-app': string.unquote("oklch(0.15 0.02 260)"), // Dark Deep Blue
            'bg-surface': string.unquote("oklch(0.20 0.03 260)"), // Slightly lighter
            'text-main': map.get($palette-sovereign, 'white'),
            'text-inverse': map.get($palette-sovereign, 'gray-900'),
            'primary': string.unquote("oklch(0.40 0.10 260)"), // Lighter primary for dark mode
            'secondary': string.unquote("oklch(0.60 0.20 25)"), // Lighter secondary for dark mode
            'border': string.unquote("oklch(0.30 0.02 260)"),
        )),
    'children': ('light': ('bg-app': map.get($palette-playful, 'gray-50'),
            'bg-surface': map.get($palette-playful, 'white'),
            'text-main': map.get($palette-playful, 'gray-900'),
            'text-inverse': map.get($palette-playful, 'white'),
            'primary': map.get($palette-playful, 'primary'),
            'secondary': map.get($palette-playful, 'secondary'),
            'border': string.unquote("oklch(0.92 0.01 90)"),
        ),
        'dark': ('bg-app': string.unquote("oklch(0.15 0.02 260)"),
            'bg-surface': string.unquote("oklch(0.20 0.03 260)"),
            'text-main': map.get($palette-playful, 'white'),
            'text-inverse': map.get($palette-playful, 'gray-900'),
            'primary': string.unquote("oklch(0.70 0.15 250)"),
            'secondary': string.unquote("oklch(0.75 0.18 20)"),
            'border': string.unquote("oklch(0.30 0.02 260)"),
        ))
);

// 3. Spacing & Radius (Constant Algorithm)
$spacing: (
    'xs': 0.25rem,
    'sm': 0.5rem,
    'md': 1rem,
    'lg': 1.5rem,
    'xl': 3rem
);

$radius: (
    'sm': 0.25rem,
    'md': 0.5rem,
    'lg': 1rem,
    'xl': 2rem,
    'full': 9999px
);

// 4. Restoration Algorithm (Mixin)
// Injects CSS variables based on the active theme and mode
@mixin generate-themes {

    // Default Variables (Spacing, Radius, Typography, Layout) - Constant across themes
    :root {
        /* Lovable HSL Variables (Gold Standard) */
        --background: 222 47% 11%;
        --foreground: 210 40% 98%;

        --card: 222 47% 14%;
        --card-foreground: 210 40% 98%;

        --popover: 222 47% 14%;
        --popover-foreground: 210 40% 98%;

        --primary: 263 70% 50%;
        --primary-foreground: 210 40% 98%;

        --secondary: 217 33% 17%;
        --secondary-foreground: 210 40% 98%;

        --muted: 217 33% 17%;
        --muted-foreground: 215 20% 65%;

        --accent: 221 83% 53%;
        --accent-foreground: 210 40% 98%;

        --destructive: 0 84% 60%;
        --destructive-foreground: 210 40% 98%;

        --border: 217 33% 25%;
        --input: 217 33% 25%;
        --ring: 263 70% 50%;

        --radius: 0.75rem;

        /* Custom colors for gradients */
        --purple: 263 70% 50%;
        --blue: 221 83% 53%;
        --navy: 222 47% 11%;
        --navy-light: 222 47% 18%;

        /* Glassmorphism */
        --glass-bg: 222 47% 11% / 0.7;
        --glass-border: 217 33% 30% / 0.5;

        /* Sidebar */
        --sidebar-background: 222 47% 8%;
        --sidebar-foreground: 210 40% 98%;
        --sidebar-primary: 263 70% 50%;
        --sidebar-primary-foreground: 210 40% 98%;
        --sidebar-accent: 217 33% 17%;
        --sidebar-accent-foreground: 210 40% 98%;
        --sidebar-border: 217 33% 20%;
        --sidebar-ring: 263 70% 50%;

        // Legacy/Semantic Mappings (Backwards Compatibility)
        --color-bg-app: hsl(var(--background));
        --color-bg-surface: hsl(var(--card));
        --color-text-main: hsl(var(--foreground));
        --color-primary-500: hsl(var(--primary));
        // ... (Other specific mappings can be added as deemed necessary)

        // Spacing tokens
        @each $key, $value in $spacing {
            --space-#{$key}: #{$value};
        }

        // Radius tokens
        @each $key, $value in $radius {
            --radius-#{$key}: #{$value};
        }

        // Typography tokens
        --font-family-base: 'Cairo',
        'Inter',
        sans-serif; // Updated to Cairo
        --font-family-heading: 'Cairo',
        sans-serif;
        --font-size-base: 1rem;
        --line-height-base: 1.6;
        --font-weight-normal: 400;
        --font-weight-medium: 500;
        --font-weight-semibold: 600;
        --font-weight-bold: 700;

        // Layout tokens
        --container-max-width: 1400px; // Updated to 2xl
        --container-padding: 2rem;
        --header-height: 64px;
        --sidebar-width: 280px;
        --sidebar-collapsed-width: 64px;
        --footer-height: 80px;

        // Transition tokens
        --transition-base: 150ms ease;
        --transition-slow: 300ms ease;
        --transition-fast: 100ms ease;

        // Z-index scale
        --z-dropdown: 1000;
        --z-sticky: 1020;
        --z-fixed: 1030;
        --z-modal-backdrop: 1040;
        --z-modal: 1050;
        --z-popover: 1060;
        --z-tooltip: 1070;
    }

    // Light Mode Support (Rarely used in this design, but good for completeness)
    .light {
        --background: 0 0% 100%;
        --foreground: 222.2 47.4% 11.2%;
        // ... (Add full light palette if needed, otherwise fallback to root/dark)
    }
}

// 5. Tier System Mixin
// Applies styles based on the user's plan (Plan Sovereignty)
// Usage: @include tier('premium') { ... }
@mixin tier($name) {
    :global(body.tier-#{$name}) & {
        @content;
    }
}