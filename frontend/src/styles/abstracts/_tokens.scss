@use 'sass:map';
@use 'sass:string';

/**
 * Sovereign Design Tokens (OKLCH)
 * Single source of truth for the algorithmic design system.
 */

// 1. Base Palette Matrices (OKLCH)
// Omani Identity (University Persona)
$palette-sovereign: (
    'primary': string.unquote("oklch(0.285 0.05 260)"),
    // Deep Blue Identity
    'secondary': string.unquote("oklch(0.53 0.22 25)"),
    // Honor Red
    'success': string.unquote("oklch(0.55 0.18 142)"),
    // Growth Green
    'warning': string.unquote("oklch(0.80 0.15 85)"),
    // Alert Gold
    'error': string.unquote("oklch(0.55 0.22 25)"),
    // Error Red (same as secondary for consistency)
    'info': string.unquote("oklch(0.60 0.15 220)"),
    // Info Blue
    'white': string.unquote("oklch(1 0 0)"),
    'black': string.unquote("oklch(0 0 0)"),
    'gray-50': string.unquote("oklch(0.98 0.01 260)"),
    'gray-100': string.unquote("oklch(0.95 0.01 260)"),
    'gray-200': string.unquote("oklch(0.90 0.01 260)"),
    'gray-300': string.unquote("oklch(0.80 0.01 260)"),
    'gray-400': string.unquote("oklch(0.65 0.01 260)"),
    'gray-500': string.unquote("oklch(0.50 0.01 260)"),
    'gray-600': string.unquote("oklch(0.40 0.02 260)"),
    'gray-700': string.unquote("oklch(0.30 0.02 260)"),
    'gray-800': string.unquote("oklch(0.25 0.02 260)"),
    'gray-900': string.unquote("oklch(0.20 0.02 260)")
);

// Playful Identity (Children Persona)
$palette-playful: (
    'primary': string.unquote("oklch(0.65 0.18 250)"),
    // Playful Blue
    'secondary': string.unquote("oklch(0.70 0.20 20)"),
    // Playful Red
    'success': string.unquote("oklch(0.65 0.18 142)"),
    // Same Green usually
    'warning': string.unquote("oklch(0.85 0.16 85)"),
    'white': string.unquote("oklch(1 0 0)"),
    'black': string.unquote("oklch(0 0 0)"),
    'gray-50': string.unquote("oklch(0.99 0.01 90)"),
    'gray-900': string.unquote("oklch(0.20 0.02 260)")
);

// 2. Theme Configuration Map
// Defines semantic tokens for each mode/persona tuple
$themes-config: (
    'university': ('light': ('bg-app': map.get($palette-sovereign, 'gray-50'),
            'bg-surface': map.get($palette-sovereign, 'white'),
            'text-main': map.get($palette-sovereign, 'gray-900'),
            'text-inverse': map.get($palette-sovereign, 'white'),
            'primary': map.get($palette-sovereign, 'primary'),
            'secondary': map.get($palette-sovereign, 'secondary'),
            'border': string.unquote("oklch(0.92 0.01 260)"), // Light gray border
        ),
        'dark': ('bg-app': string.unquote("oklch(0.15 0.02 260)"), // Dark Deep Blue
            'bg-surface': string.unquote("oklch(0.20 0.03 260)"), // Slightly lighter
            'text-main': map.get($palette-sovereign, 'white'),
            'text-inverse': map.get($palette-sovereign, 'gray-900'),
            'primary': string.unquote("oklch(0.40 0.10 260)"), // Lighter primary for dark mode
            'secondary': string.unquote("oklch(0.60 0.20 25)"), // Lighter secondary for dark mode
            'border': string.unquote("oklch(0.30 0.02 260)"),
        )),
    'children': ('light': ('bg-app': map.get($palette-playful, 'gray-50'),
            'bg-surface': map.get($palette-playful, 'white'),
            'text-main': map.get($palette-playful, 'gray-900'),
            'text-inverse': map.get($palette-playful, 'white'),
            'primary': map.get($palette-playful, 'primary'),
            'secondary': map.get($palette-playful, 'secondary'),
            'border': string.unquote("oklch(0.92 0.01 90)"),
        ),
        'dark': ('bg-app': string.unquote("oklch(0.15 0.02 260)"),
            'bg-surface': string.unquote("oklch(0.20 0.03 260)"),
            'text-main': map.get($palette-playful, 'white'),
            'text-inverse': map.get($palette-playful, 'gray-900'),
            'primary': string.unquote("oklch(0.70 0.15 250)"),
            'secondary': string.unquote("oklch(0.75 0.18 20)"),
            'border': string.unquote("oklch(0.30 0.02 260)"),
        ))
);

// 3. Spacing & Radius (Constant Algorithm)
$spacing: (
    'xs': 0.25rem,
    'sm': 0.5rem,
    'md': 1rem,
    'lg': 1.5rem,
    'xl': 3rem
);

$radius: (
    'sm': 0.25rem,
    'md': 0.5rem,
    'lg': 1rem,
    'xl': 2rem,
    'full': 9999px
);

// 4. Restoration Algorithm (Mixin)
// Injects CSS variables based on the active theme and mode
@mixin generate-themes {

    // Default Variables (Spacing, Radius, Typography, Layout) - Constant across themes
    :root {

        // Spacing tokens
        @each $key, $value in $spacing {
            --space-#{$key}: #{$value};
        }

        // Radius tokens
        @each $key, $value in $radius {
            --radius-#{$key}: #{$value};
        }

        // Typography tokens
        --font-family-base: 'Noto Sans Arabic',
        'Inter',
        'Segoe UI',
        sans-serif;
        --font-family-heading: 'Clash Grotesk',
        'Inter',
        sans-serif;
        --font-size-base: 1rem;
        --line-height-base: 1.6;
        --font-weight-normal: 400;
        --font-weight-medium: 500;
        --font-weight-semibold: 600;
        --font-weight-bold: 700;

        // Layout tokens
        --container-max-width: 1280px;
        --container-padding: 1.5rem;
        --header-height: 64px;
        --sidebar-width: 280px;
        --sidebar-collapsed-width: 64px;
        --footer-height: 80px;

        // Transition tokens
        --transition-base: 150ms ease;
        --transition-slow: 300ms ease;
        --transition-fast: 100ms ease;

        // Spacing aliases (semantic names for compatibility)
        --spacing-xs: var(--space-xs);
        --spacing-sm: var(--space-sm);
        --spacing-md: var(--space-md);
        --spacing-lg: var(--space-lg);
        --spacing-xl: var(--space-xl);

        // Z-index scale
        --z-dropdown: 1000;
        --z-sticky: 1020;
        --z-fixed: 1030;
        --z-modal-backdrop: 1040;
        --z-modal: 1050;
        --z-popover: 1060;
        --z-tooltip: 1070;

        // Shadow tokens (OKLCH-based for theme consistency)
        --shadow-sm: 0 1px 2px 0 oklch(0 0 0 / 0.05);
        --shadow-md: 0 4px 6px -1px oklch(0 0 0 / 0.1),
        0 2px 4px -2px oklch(0 0 0 / 0.1);
        --shadow-lg: 0 10px 15px -3px oklch(0 0 0 / 0.1),
        0 4px 6px -4px oklch(0 0 0 / 0.1);
        --shadow-xl: 0 20px 25px -5px oklch(0 0 0 / 0.1),
        0 8px 10px -6px oklch(0 0 0 / 0.1);
        --shadow-2xl: 0 25px 50px -12px oklch(0 0 0 / 0.25);

        // Notification/Toast state colors (OKLCH Logic)
        --color-success: #{map.get($palette-sovereign, 'success')};
        --color-error: #{map.get($palette-sovereign, 'error')};
        --color-warning: #{map.get($palette-sovereign, 'warning')};
        --color-info: #{map.get($palette-sovereign, 'info')};

        // Monospace font for error panels/code
        --font-family-mono: 'Fira Code',
        'Consolas',
        'Monaco',
        'Courier New',
        monospace;
    }

    // Iterate over Persona (university, children)
    @each $persona, $modes in $themes-config {

        // Default Mode (Light) for each persona class
        .theme-#{$persona} {
            $light-tokens: map.get($modes, 'light');

            @each $key, $value in $light-tokens {
                --color-#{$key}: #{$value};
            }
        }

        // Explicit Dark Mode override for each persona
        @media (prefers-color-scheme: dark) {
            .theme-#{$persona} {
                $dark-tokens: map.get($modes, 'dark');

                @each $key, $value in $dark-tokens {
                    --color-#{$key}: #{$value};
                }
            }
        }

        // Manual 'dark-mode' class override (when user manually toggles dark mode)
        .theme-#{$persona}.dark-mode,
        .dark-mode .theme-#{$persona} {
            $dark-tokens: map.get($modes, 'dark');

            @each $key, $value in $dark-tokens {
                --color-#{$key}: #{$value};
            }
        }

        // Support for ThemeProvider's effectiveMode
        .theme-#{$persona}.theme-dark {
            $dark-tokens: map.get($modes, 'dark');

            @each $key, $value in $dark-tokens {
                --color-#{$key}: #{$value};
            }
        }
    }
}