"""
Main Entry Point for Testing System
main.py

Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
"""

import asyncio
import logging
import sys
from pathlib import Path

# Ø¥Ø¶Ø§ÙØ© Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
project_root = Path(__file__).parent.parent
sys.path.insert(0, str(project_root))

from test_automation.test_orchestrator import TestOrchestrator, TestType
from test_automation.result_collector import ResultCollector
import json

# Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)


async def main():
    """Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"""
    print("ğŸ§ª Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ§Ù„ØªÙƒØ§Ù…Ù„")
    print("=" * 50)
    
    try:
        # ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ù†Ø³Ù‚
        orchestrator = TestOrchestrator(project_root=project_root)
        await orchestrator.initialize()
        
        # ØªÙ‡ÙŠØ¦Ø© Ø¬Ø§Ù…Ø¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        collector = ResultCollector()
        
        # ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
        print("\nğŸš€ Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª...")
        results = await orchestrator.run_all_tests(
            test_types=[TestType.UNIT],  # Ø§Ø¨Ø¯Ø£ Ø¨Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø§Øª
            parallel=False
        )
        
        # Ø¬Ù…Ø¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        collector.collect_from_orchestrator(results)
        
        # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ø®Øµ
        summary = collector.generate_summary()
        
        print("\nğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ù†ØªØ§Ø¦Ø¬:")
        print(json.dumps(summary, indent=2, ensure_ascii=False))
        
        # Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        report_path = collector.save_results()
        print(f"\nğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙÙŠ: {report_path}")
        
        # Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ù†Ø³Ù‚
        await orchestrator.shutdown()
        
        print("\nâœ… Ø§ÙƒØªÙ…Ù„ ØªÙ†ÙÙŠØ° Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª!")
        
    except KeyboardInterrupt:
        print("\nâš ï¸ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…")
    except Exception as e:
        logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ†ÙÙŠØ° Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª: {e}")
        sys.exit(1)


if __name__ == "__main__":
    asyncio.run(main())

